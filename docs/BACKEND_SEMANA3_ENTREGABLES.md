# üîß BACKEND DEVELOPER - SEMANA 3 ENTREGABLES

## üìÖ **SEMANA 3: Backend ‚Äî APIs de Combos y Plataformas**

**Fecha inicio:** 31 de agosto de 2025 **Fecha l√≠mite:** 7 de septiembre de 2025
**Responsable:** Backend Developer **Estado inicial:** 85% preparado
(autenticaci√≥n completa) **Estado objetivo:** üíØ 100% COMPLETADO

### üéØ **OBJETIVO PRINCIPAL**

Implementar las APIs completas para gesti√≥n de combos y plataformas que
permitir√°n al frontend (semana 3-4) ofrecer la funcionalidad core del MVP:
creaci√≥n y gesti√≥n de combos personalizados.

---

## üèóÔ∏è **CONTEXTO T√âCNICO**

### **Estado actual del backend:**

- ‚úÖ **Sistema de autenticaci√≥n** enterprise-grade funcionando
- ‚úÖ **Base de datos** Prisma schema completo con todos los modelos
- ‚úÖ **Infraestructura** Express + middlewares + logging funcionando
- ‚úÖ **Testing** Jest framework con 92% tests pasando

### **Necesidades inmediatas:**

- üéØ **APIs de plataformas** para mostrar opciones disponibles
- üéØ **APIs de combos** para crear/gestionar combos personalizados
- üéØ **L√≥gica de negocio** para validaciones y reglas de combos
- üéØ **Controllers robustos** con manejo de errores y validaciones

---

## üìã **ENTREGABLES PRINCIPALES**

### **ENTREGABLE 1: Platform Management APIs**

**Descripci√≥n:** Implementar las APIs completas para gesti√≥n de plataformas
disponibles **Prioridad:** üî¥ ALTA - Requerido para frontend semana 3

#### **Tareas espec√≠ficas:**

1. **Crear `/apps/backend/src/controllers/platforms.ts`**

   ```typescript
   // IMPLEMENTAR:
   -getAllPlatforms(req, res, next) - // GET /api/platforms
     getPlatformById(req, res, next) - // GET /api/platforms/:id
     createPlatform(req, res, next) - // POST /api/platforms (admin)
     updatePlatform(req, res, next) - // PUT /api/platforms/:id (admin)
     deletePlatform(req, res, next); // DELETE /api/platforms/:id (admin)
   ```

2. **Crear `/apps/backend/src/routes/platforms.ts`**

   ```typescript
   // RUTAS IMPLEMENTAR:
   router.get('/', getAllPlatforms); // P√∫blico
   router.get('/:id', getPlatformById); // P√∫blico
   router.post('/', authMiddleware, adminMiddleware, createPlatform);
   router.put('/:id', authMiddleware, adminMiddleware, updatePlatform);
   router.delete('/:id', authMiddleware, adminMiddleware, deletePlatform);
   ```

3. **Crear `/apps/backend/src/services/platformService.ts`**
   ```typescript
   // L√ìGICA DE NEGOCIO:
   - findAllActivePlatforms()
   - findPlatformById(id: string)
   - createNewPlatform(data: PlatformCreateInput)
   - updatePlatformById(id: string, data: PlatformUpdateInput)
   - softDeletePlatform(id: string)
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] GET `/api/platforms` retorna todas las plataformas activas
- [ ] GET `/api/platforms/:id` retorna plataforma espec√≠fica o 404
- [ ] POST `/api/platforms` crea nueva plataforma (solo admin)
- [ ] PUT `/api/platforms/:id` actualiza plataforma existente (solo admin)
- [ ] DELETE `/api/platforms/:id` desactiva plataforma (soft delete, solo admin)
- [ ] Todos los endpoints con validaci√≥n zod y manejo de errores
- [ ] Tests unitarios para todos los endpoints (Jest + Supertest)

---

### **ENTREGABLE 2: Combo Template Management APIs**

**Descripci√≥n:** Implementar las APIs para gesti√≥n de plantillas de combos
predefinidos **Prioridad:** üî¥ ALTA - Base para funcionalidad de combos

#### **Tareas espec√≠ficas:**

1. **Crear `/apps/backend/src/controllers/comboTemplates.ts`**

   ```typescript
   // IMPLEMENTAR:
   -getAllComboTemplates(req, res, next) - // GET /api/combo-templates
     getComboTemplateById(req, res, next) - // GET /api/combo-templates/:id
     createComboTemplate(req, res, next) - // POST /api/combo-templates (admin)
     updateComboTemplate(req, res, next) - // PUT /api/combo-templates/:id (admin)
     deleteComboTemplate(req, res, next); // DELETE /api/combo-templates/:id (admin)
   ```

2. **Crear `/apps/backend/src/routes/comboTemplates.ts`**

   ```typescript
   // RUTAS CON MIDDLEWARES:
   router.get('/', getAllComboTemplates); // P√∫blico
   router.get('/:id', getComboTemplateById); // P√∫blico
   router.post('/', authMiddleware, adminMiddleware, createComboTemplate);
   router.put('/:id', authMiddleware, adminMiddleware, updateComboTemplate);
   router.delete('/:id', authMiddleware, adminMiddleware, deleteComboTemplate);
   ```

3. **Crear `/apps/backend/src/services/comboTemplateService.ts`**
   ```typescript
   // L√ìGICA DE NEGOCIO:
   - findAllActiveTemplates() // Con platforms incluidas
   - findTemplateById(id: string)
   - createNewTemplate(data: ComboTemplateCreateInput)
   - updateTemplateById(id: string, data: ComboTemplateUpdateInput)
   - softDeleteTemplate(id: string)
   - validateTemplatePlatforms(platformIds: string[])
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] GET `/api/combo-templates` retorna todos los templates con plataformas
      incluidas
- [ ] GET `/api/combo-templates/:id` retorna template espec√≠fico con plataformas
- [ ] POST `/api/combo-templates` crea nuevo template con plataformas asociadas
- [ ] PUT `/api/combo-templates/:id` actualiza template y sus plataformas
- [ ] DELETE `/api/combo-templates/:id` desactiva template (soft delete)
- [ ] Validaci√≥n de m√≠nimo 2 plataformas por template
- [ ] Tests unitarios completos

---

### **ENTREGABLE 3: User Combos Management APIs**

**Descripci√≥n:** Implementar las APIs para que usuarios creen y gestionen sus
combos personalizados **Prioridad:** üü° MEDIA - Para semana 4 principalmente

#### **Tareas espec√≠ficas:**

1. **Crear `/apps/backend/src/controllers/combos.ts`**

   ```typescript
   // IMPLEMENTAR:
   -getUserCombos(req, res, next) - // GET /api/combos
     getComboById(req, res, next) - // GET /api/combos/:id
     createUserCombo(req, res, next) - // POST /api/combos
     updateUserCombo(req, res, next) - // PUT /api/combos/:id
     cancelUserCombo(req, res, next); // DELETE /api/combos/:id
   ```

2. **Crear `/apps/backend/src/routes/combos.ts`**

   ```typescript
   // RUTAS PROTEGIDAS:
   router.get('/', authMiddleware, getUserCombos); // Solo combos del usuario
   router.get('/:id', authMiddleware, getComboById); // Solo si es del usuario
   router.post('/', authMiddleware, createUserCombo); // Crear nuevo combo
   router.put('/:id', authMiddleware, updateUserCombo); // Solo si es del usuario
   router.delete('/:id', authMiddleware, cancelUserCombo); // Cancelar combo
   ```

3. **Crear `/apps/backend/src/services/comboService.ts`**
   ```typescript
   // L√ìGICA DE NEGOCIO COMPLEJA:
   - findUserCombos(userId: string)
   - findComboById(id: string, userId: string)
   - createUserCombo(userId: string, templateId: string, customPrice?: number)
   - updateUserCombo(id: string, userId: string, data: ComboUpdateInput)
   - cancelUserCombo(id: string, userId: string)
   - validateUserComboOwnership(comboId: string, userId: string)
   - calculateComboPrice(templateId: string)
   - validateOneActiveComboPerUser(userId: string)
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] GET `/api/combos` retorna solo combos del usuario autenticado
- [ ] GET `/api/combos/:id` retorna combo espec√≠fico si pertenece al usuario
- [ ] POST `/api/combos` crea nuevo combo basado en template
- [ ] PUT `/api/combos/:id` actualiza combo si pertenece al usuario
- [ ] DELETE `/api/combos/:id` cancela combo (soft delete)
- [ ] Validaci√≥n: m√°ximo 1 combo activo por usuario
- [ ] Validaci√≥n: usuario solo puede acceder a sus propios combos
- [ ] Tests unitarios con casos edge

---

### **ENTREGABLE 4: Admin Dashboard APIs**

**Descripci√≥n:** APIs espec√≠ficas para administraci√≥n del sistema **Prioridad:**
üü¢ BAJA - Para futuras semanas

#### **Tareas espec√≠ficas:**

1. **Crear `/apps/backend/src/controllers/admin.ts`**

   ```typescript
   // IMPLEMENTAR:
   -getDashboardStats(req, res, next) - // GET /api/admin/dashboard
     getAllUsers(req, res, next) - // GET /api/admin/users
     getAllCombos(req, res, next) - // GET /api/admin/combos
     getUserDetails(req, res, next) - // GET /api/admin/users/:id
     updateUserStatus(req, res, next); // PUT /api/admin/users/:id/status
   ```

2. **Crear `/apps/backend/src/routes/admin.ts`**

   ```typescript
   // RUTAS SUPER PROTEGIDAS:
   router.get('/dashboard', authMiddleware, adminMiddleware, getDashboardStats);
   router.get('/users', authMiddleware, adminMiddleware, getAllUsers);
   router.get('/combos', authMiddleware, adminMiddleware, getAllCombos);
   router.get('/users/:id', authMiddleware, adminMiddleware, getUserDetails);
   router.put(
     '/users/:id/status',
     authMiddleware,
     adminMiddleware,
     updateUserStatus,
   );
   ```

3. **Crear `/apps/backend/src/services/adminService.ts`**
   ```typescript
   // ANALYTICS Y GESTI√ìN:
   - generateDashboardStats()
   - findAllUsersWithPagination(page: number, limit: number)
   - findAllCombosWithFilters(filters: ComboFilters)
   - findUserWithDetails(userId: string)
   - updateUserStatus(userId: string, status: UserStatus)
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] GET `/api/admin/dashboard` retorna estad√≠sticas del sistema
- [ ] GET `/api/admin/users` retorna usuarios con paginaci√≥n
- [ ] GET `/api/admin/combos` retorna todos los combos con filtros
- [ ] PUT `/api/admin/users/:id/status` actualiza estado de usuario
- [ ] Todas las rutas requieren autenticaci√≥n + rol admin
- [ ] Tests unitarios para funciones cr√≠ticas

---

### **ENTREGABLE 5: Validation Schemas & Error Handling**

**Descripci√≥n:** Schemas de validaci√≥n completos y manejo de errores robusto
**Prioridad:** üî¥ ALTA - Cr√≠tico para calidad

#### **Tareas espec√≠ficas:**

1. **Crear `/apps/backend/src/schemas/platform.ts`**

   ```typescript
   // SCHEMAS ZOD:
   export const createPlatformSchema = z.object({
     name: z.string().min(2).max(50),
     logoUrl: z.string().url().optional(),
     description: z.string().max(500).optional(),
     isActive: z.boolean().default(true),
   });

   export const updatePlatformSchema = createPlatformSchema.partial();
   ```

2. **Crear `/apps/backend/src/schemas/combo.ts`**

   ```typescript
   // SCHEMAS PARA COMBOS:
   export const createComboTemplateSchema = z.object({
     name: z.string().min(2).max(100),
     description: z.string().max(500).optional(),
     price: z.number().positive().optional(),
     platformIds: z.array(z.string().cuid()).min(2, 'M√≠nimo 2 plataformas'),
     isActive: z.boolean().default(true),
   });

   export const createUserComboSchema = z.object({
     comboTemplateId: z.string().cuid(),
     customPrice: z.number().positive().optional(),
   });
   ```

3. **Crear `/apps/backend/src/middlewares/adminMiddleware.ts`**
   ```typescript
   // MIDDLEWARE PARA ADMIN:
   export const adminMiddleware = (
     req: Request,
     res: Response,
     next: NextFunction,
   ) => {
     const user = req.user as User;
     if (user.role !== 'ADMIN' && user.role !== 'SUPERADMIN') {
       return res.status(403).json({
         error: 'Forbidden',
         message: 'Acceso denegado. Requiere permisos de administrador.',
       });
     }
     next();
   };
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] Todos los endpoints tienen validaci√≥n zod
- [ ] Mensajes de error claros y consistentes
- [ ] Middleware de admin funcional
- [ ] Validaciones espec√≠ficas de negocio implementadas
- [ ] Tests para casos de error y validaci√≥n

---

### **ENTREGABLE 6: Database Seed & Initial Data**

**Descripci√≥n:** Poblar la base de datos con datos iniciales para desarrollo y
testing **Prioridad:** üü° MEDIA - Para facilitar desarrollo

#### **Tareas espec√≠ficas:**

1. **Actualizar `/packages/prisma/seed.ts`**

   ```typescript
   // DATOS INICIALES:
   - Crear 3 plataformas base: Disney+, HBO Max, Canva Pro
   - Crear 3 combo templates predefinidos
   - Crear usuario admin para testing
   - Crear relaciones ComboPlatform
   ```

2. **Crear `/apps/backend/src/lib/seedData.ts`**

   ```typescript
   // DATOS ESTRUCTURADOS:
   export const initialPlatforms = [
     { name: 'Disney+', logoUrl: '...', description: '...' },
     { name: 'HBO Max', logoUrl: '...', description: '...' },
     { name: 'Canva Pro', logoUrl: '...', description: '...' },
   ];

   export const initialComboTemplates = [
     { name: 'Combo Entretenimiento', platforms: ['Disney+', 'HBO Max'] },
     { name: 'Combo Creativo', platforms: ['Disney+', 'Canva Pro'] },
     { name: 'Combo Completo', platforms: ['Disney+', 'HBO Max', 'Canva Pro'] },
   ];
   ```

#### **Criterios de aceptaci√≥n:**

- [ ] Seed script crea datos iniciales consistentes
- [ ] Plataformas base disponibles al iniciar
- [ ] Combo templates predefinidos funcionando
- [ ] Usuario admin para testing creado
- [ ] Script `npm run db:seed` funciona sin errores

---

## üß™ **TESTING REQUIREMENTS**

### **Coverage m√≠nimo requerido: 85%**

#### **Tests unitarios obligatorios:**

- [ ] **Platform Controller Tests:** 10+ test cases
- [ ] **Combo Template Controller Tests:** 12+ test cases
- [ ] **User Combo Controller Tests:** 15+ test cases
- [ ] **Admin Controller Tests:** 8+ test cases
- [ ] **Service Layer Tests:** 20+ test cases
- [ ] **Validation Schema Tests:** 10+ test cases

#### **Tests de integraci√≥n:**

- [ ] **API Integration Tests:** End-to-end para flujos principales
- [ ] **Database Tests:** Verificar relaciones y constraints
- [ ] **Authentication Tests:** Verificar protecci√≥n de rutas

#### **Estructura de tests:**

```
/apps/backend/src/__tests__/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ platforms.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ comboTemplates.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ combos.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ admin.test.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ platformService.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ comboTemplateService.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ comboService.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ adminService.test.ts
‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îú‚îÄ‚îÄ platforms.integration.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ combos.integration.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ auth.integration.test.ts
‚îî‚îÄ‚îÄ schemas/
    ‚îú‚îÄ‚îÄ platform.schema.test.ts
    ‚îî‚îÄ‚îÄ combo.schema.test.ts
```

---

## üîß **TECHNICAL SPECIFICATIONS**

### **API Response Format Est√°ndar:**

```typescript
// Success Response
{
  success: true,
  data: T,
  message?: string,
  pagination?: {
    page: number,
    limit: number,
    total: number,
    totalPages: number
  }
}

// Error Response
{
  success: false,
  error: string,
  message: string,
  details?: any
}
```

### **Database Considerations:**

- Usar transacciones para operaciones complejas
- Implementar soft deletes (isActive: false)
- √çndices en campos de b√∫squeda frecuente
- Validaciones a nivel de base de datos y aplicaci√≥n

### **Performance Requirements:**

- Endpoints deben responder en < 200ms
- Queries optimizadas con includes espec√≠ficos
- Paginaci√≥n en listas grandes (limit: 20 por defecto)
- Cache headers apropiados

### **Security Requirements:**

- Validaci√≥n de input en todos los endpoints
- Rate limiting configurado
- Logs de seguridad para acciones admin
- Sanitizaci√≥n de datos de salida

---

## üéØ **DEFINITION OF DONE**

### **Para considerar un entregable COMPLETADO:**

- [x] ‚úÖ **C√≥digo implementado** y funcionando en desarrollo
- [x] ‚úÖ **Tests unitarios** pasando con coverage > 85%
- [x] ‚úÖ **Tests de integraci√≥n** verificando flujos completos
- [x] ‚úÖ **Validaci√≥n zod** en todos los endpoints
- [x] ‚úÖ **Manejo de errores** robusto y consistente
- [x] ‚úÖ **Documentaci√≥n** de APIs actualizada
- [x] ‚úÖ **Seed data** funcionando para desarrollo
- [x] ‚úÖ **Code review** interno completado
- [x] ‚úÖ **Integration testing** con frontend (si aplicable)

### **Comandos de verificaci√≥n:**

```bash
# Verificar que todo funciona
npm run test:backend          # Todos los tests pasando
npm run build:backend         # Build sin errores
npm run dev:backend           # Servidor iniciando sin errores
npm run db:seed               # Seed data cargando correctamente

# Verificar endpoints (con servidor corriendo)
curl http://localhost:3001/api/platforms
curl http://localhost:3001/api/combo-templates
curl -H "Authorization: Bearer <token>" http://localhost:3001/api/combos
```

---

## üöÄ **NEXT STEPS (Semana 4)**

### **Preparaci√≥n para semana 4:**

1. **Payment Integration APIs** - Stripe/MercadoPago
2. **Subscription Management** - L√≥gica de facturaci√≥n
3. **Account Assignment APIs** - Asignar cuentas de plataformas
4. **Notification System** - Emails y webhooks
5. **Advanced Analytics** - M√©tricas de negocio

### **Frontend Integration Support:**

- **API Documentation** actualizada para frontend team
- **Mock Data** disponible para development
- **CORS Configuration** para desarrollo local
- **Error Codes** documentados para UX

---

## üìû **SUPPORT & ESCALATION**

### **Puntos de contacto:**

- **Technical Issues:** Backend Developer + Technical Lead
- **Business Logic Questions:** Product Owner
- **Database Issues:** DevOps + Database Lead
- **Integration Issues:** Frontend Team Lead

### **Escalation criteria:**

- **Blocker detectado:** Escalar inmediatamente
- **Delay > 1 d√≠a:** Escalar a Technical Lead
- **Breaking changes:** Coordinar con Frontend Team
- **Performance issues:** Escalar a DevOps Team

---

**‚úÖ SEMANA 3 COMPLETADA = BACKEND APIS COMPLETAS PARA GESTI√ìN DE COMBOS Y
PLATAFORMAS**

_Documento creado: 29 de agosto de 2025_ _Versi√≥n: 1.0_ _Pr√≥xima revisi√≥n: 7 de
septiembre de 2025_
